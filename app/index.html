<!DOCTYPE html>
<html>
<head>
  <title>Cytoscape Test</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="assets/css/style.css">
</head>
<body>
<header>
</header>

<div id="cy"></div>

<script type="text/javascript" src="assets/js/cytoscape/cytoscape.min.js"></script>
<script type="text/javascript" src="assets/js/cytoscape-edgehandles/cytoscape-edgehandles.js"></script>
<script type="text/javascript" src="assets/js/jquery-3.1.1.min.js"></script>

<script type="text/javascript">
  var cy = cytoscape({

    container: $('#cy'), // container to render in

    elements: [ // list of graph elements to start with
      // { // node a
      //   data: { id: 'a' }
      // },
      // { // node b
      //   data: { id: 'b' }
      // },
      // { // node c
      //   data: { id: 'c' }
      // },
      // { // edge ab
      //   data: { id: 'ab', source: 'a', target: 'b' }
      // },
      // { // edge ab
      //   data: { id: 'bc', source: 'b', target: 'c' }
      // },
      // { // edge ab
      //   data: { id: 'cb', source: 'c', target: 'b' }
      // }
    ],

    style: [ // the stylesheet for the graph
      {
        selector: 'node',
        style: {
          'width':40,
          'height':40,
          'background-color': '#666',
          'label': 'data(id)'
        }
      },

      {
        selector: 'edge',
        style: {
          'width': 1,
          'label':'data(label)',
          'target-arrow-shape': 'triangle',
          'line-color': '#333',
          'target-arrow-color': '#333',
          'curve-style': 'bezier'
        }
      }
    ],

    layout: {
      name: 'grid',
      rows: 1
    }

  });
  //Math.floor((Math.random() * 1000) + 1)
  var q = 0;
  $('#cy').on('dblclick', function(event){
    console.log(event);
    var elm = $(this);
    cy.add({
      group: "nodes",
      data: { id: "q"+q },
      position: { 
        x: (event.pageX - elm.offset().left), 
        y: (event.pageY - elm.offset().top) 
      },

    });

    q++;
  });


  // the default values of each option are outlined below:
  var defaults = {
    preview: true, // whether to show added edges preview before releasing selection
    stackOrder: 4, // Controls stack order of edgehandles canvas element by setting it's z-index
    handleSize: 10, // the size of the edge handle put on nodes
    handleColor: '#ff0000', // the colour of the handle and the line drawn from it
    handleLineType: 'ghost', // can be 'ghost' for real edge, 'straight' for a straight line, or 'draw' for a draw-as-you-go line
    handleLineWidth: 1, // width of handle line in pixels
    handleIcon: false, // Pass an Image-object to use as icon on handle. Icons are resized according to zoom and centered in handle.
    handleNodes: 'node', // selector/filter function for whether edges can be made from a given node
    hoverDelay: 150, // time spend over a target node before it is considered a target selection
    cxt: false, // whether cxt events trigger edgehandles (useful on touch)
    enabled: true, // whether to start the extension in the enabled state
    toggleOffOnLeave: true, // whether an edge is cancelled by leaving a node (true), or whether you need to go over again to cancel (false; allows multiple edges in one pass)
    edgeType: function( sourceNode, targetNode ) {
      // can return 'flat' for flat edges between nodes or 'node' for intermediate node between them
      // returning null/undefined means an edge can't be added between the two nodes
      return 'flat';
    },
    loopAllowed: function( node ) {
      // for the specified node, return whether edges from itself to itself are allowed
      return true;
    },
    nodeLoopOffset: -50, // offset for edgeType: 'node' loops
    nodeParams: function( sourceNode, targetNode ) {
      // for edges between the specified source and target
      // return element object to be passed to cy.add() for intermediary node
      return {};
    },
    edgeParams: function( sourceNode, targetNode, i ) {
      // for edges between the specified source and target
      // return element object to be passed to cy.add() for edge
      // NB: i indicates edge index in case of edgeType: 'node'
      return {};
    },
    start: function( sourceNode ) {
      // fired when edgehandles interaction starts (drag on handle)
    },
    complete: function( sourceNode, targetNodes, addedEntities ) {
      // fired when edgehandles is done and entities are added
      var text = prompt('Digite o caractere', "");
      if(text == "") text = "âˆ†";
      addedEntities.data('label', text);
    },
    stop: function( sourceNode ) {
      // fired when edgehandles interaction is stopped (either complete with added edges or incomplete)
    }
  };

  cy.edgehandles( defaults );

  cy.$(':selected').remove();

  cy.on('taphold', function(evt){
    console.log( 'tap ' + evt.cyTarget.id() );
    evt.cyTarget.remove();
  });
  
</script>
</body>
</html>